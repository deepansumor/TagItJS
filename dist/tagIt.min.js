var TagIt;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};(()=>{function n(t){return t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement?function(t){const e=t.getBoundingClientRect();let n=document.getElementById("textarea-caret-mirror");n||(n=document.createElement("div"),n.id="textarea-caret-mirror",document.body.appendChild(n)),n.style.position="fixed",n.style.top=`${e.top}px`,n.style.left=`${e.left}px`,n.style.width=`${e.width}px`,n.style.visibility="hidden",n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word";const i=window.getComputedStyle(t);n.style.font=i.font,n.style.padding=i.padding,n.style.border=i.border,n.style.lineHeight=i.lineHeight;const r=t.value,o=t.selectionStart||0,s=r.substring(0,o);n.textContent=s.replace(/\n$/,"\n​");const a=document.createElement("span");a.textContent="​",n.appendChild(a);const g=a.getBoundingClientRect();return{top:g.top,left:g.left}}(t):function(t){var e;let n={top:0,left:0};const i=window.getSelection();if(i&&i.rangeCount>0){const t=i.getRangeAt(0).cloneRange();t.collapse(!0);const r=document.createElement("span");r.textContent="​",t.insertNode(r);const o=r.getBoundingClientRect();n={top:o.top,left:o.left},null===(e=r.parentNode)||void 0===e||e.removeChild(r),i.removeAllRanges(),i.addRange(t)}else{const e=t.getBoundingClientRect();n={top:e.top,left:e.left}}return n}(t)}function i(t,e){const n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n)||0}function r(t,e,n){if(!e)return t;t.forEach((t=>{t.matchScore=function(t,e){const n=t.toLowerCase(),i=e.toLowerCase();if(!i)return 0;if(n===i)return 1;const r=n.indexOf(i);if(-1===r)return 0;const o=1-r/n.length;return Math.max(0,Math.min(1,o))}(t.key,e)}));const i=t.filter((t=>t.matchScore>=n));return i.sort(((t,e)=>e.matchScore-t.matchScore)),i}t.d(e,{default:()=>s});var o=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{g(i.next(t))}catch(t){o(t)}}function a(t){try{g(i.throw(t))}catch(t){o(t)}}function g(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}g((i=i.apply(t,e||[])).next())}))};class s{constructor(t,e){var n,i,r,o,s,a;this.triggerChar="@",this.savedRange=null,this.middlewares=[],this.fetchTimeout=null,this.target=t,this.suggestions=(null==e?void 0:e.suggestions)||[],this.keepTrigger=null!==(n=null==e?void 0:e.keepTrigger)&&void 0!==n&&n,this.triggerChar=null!==(i=null==e?void 0:e.triggerChar)&&void 0!==i?i:this.triggerChar,this.maxSuggestions=null!==(r=null==e?void 0:e.maxSuggestions)&&void 0!==r?r:5,this.minScore=null!==(o=null==e?void 0:e.minScore)&&void 0!==o?o:0,this.debounceTime=null!==(s=null==e?void 0:e.debounceTime)&&void 0!==s?s:300,this.enableLog=null!==(a=null==e?void 0:e.enableLog)&&void 0!==a&&a,this.fetchSuggestions=null==e?void 0:e.fetchSuggestions,this.dropdown=this.createDropdown(),this.attachEvents()}log(...t){this.enableLog&&console.log(...t)}error(...t){console.error(...t)}use(t){this.middlewares.push(t)}addSuggestion(t){this.suggestions.push(t)}removeSuggestion(t){this.suggestions=this.suggestions.filter((e=>e.key!==t))}createDropdown(){const t=document.createElement("ul");return Object.assign(t.style,{position:"fixed",display:"none",listStyle:"none",padding:"5px",margin:"0",border:"1px solid #ccc",background:"#fff"}),document.body.appendChild(t),t}attachEvents(){this.target.addEventListener("keyup",this.onKeyUp.bind(this)),document.addEventListener("click",this.onOutsideClick.bind(this))}onOutsideClick(t){this.dropdown.contains(t.target)||this.hideDropdown()}onKeyUp(t){return o(this,void 0,void 0,(function*(){try{const t=window.getSelection();if(t&&t.rangeCount>0&&(this.savedRange=t.getRangeAt(0).cloneRange()),this.isTriggerActive()){const t=n(this.target);this.fetchSuggestions?(this.fetchTimeout&&clearTimeout(this.fetchTimeout),this.fetchTimeout=window.setTimeout((()=>o(this,void 0,void 0,(function*(){try{const e=yield this.fetchSuggestions();this.suggestions=e,this.showDropdown(t)}catch(t){this.error("Error fetching suggestions:",t)}}))),this.debounceTime)):this.showDropdown(t)}else this.fetchTimeout&&(clearTimeout(this.fetchTimeout),this.fetchTimeout=null),this.hideDropdown()}catch(t){this.error("Error in onKeyUp:",t)}}))}isInputTarget(){return this.target instanceof HTMLTextAreaElement||this.target instanceof HTMLInputElement}getTextBeforeCaretForInput(){const t=this.target;return t.value.substring(0,t.selectionStart)}getTextBeforeCaretForEditable(){var t;const e=window.getSelection();if(e&&e.rangeCount>0){const n=e.getRangeAt(0),i=n.startContainer;if(i.nodeType===Node.TEXT_NODE)return(null===(t=i.textContent)||void 0===t?void 0:t.substring(0,n.startOffset))||""}return""}isTriggerActive(){let t=this.isInputTarget()?this.getTextBeforeCaretForInput():this.getTextBeforeCaretForEditable();t=t.replace(/\u00A0/g," ");const e=t.split(" "),n=e[e.length-1];return n.startsWith(this.triggerChar)||this.log("Trigger character not found before caret:",n),n.startsWith(this.triggerChar)&&-1===this.getTriggerQuery().indexOf(" ")}getQueryForInput(){const t=this.target,e=t.selectionStart,n=t.value,i=n.lastIndexOf(this.triggerChar,e);return-1===i?(this.log("Trigger character not found in input value"),""):n.substring(i+1,e)}getQueryForEditable(){const t=window.getSelection();if(t&&t.rangeCount>0){const e=t.getRangeAt(0),n=e.startContainer;if(n.nodeType===Node.TEXT_NODE){const t=n.textContent||"",i=t.lastIndexOf(this.triggerChar,e.startOffset);return-1===i?(this.log("Trigger character not found in editable content"),""):t.substring(i+1,e.startOffset)}}return""}getTriggerQuery(){return this.isInputTarget()?this.getQueryForInput():this.getQueryForEditable()}showDropdown(t){let e=[...this.suggestions];for(const t of this.middlewares)try{e=t(e)}catch(t){this.error("Error in middleware:",t)}const n=this.getTriggerQuery().toLowerCase();if(e=r(e,n,this.minScore),e=e.slice(0,this.maxSuggestions),0===e.length)return this.log("No suggestions available for query:",n),this.hideDropdown();this.dropdown.innerHTML="";const o=i(s=this.target,"normal"===window.getComputedStyle(s).getPropertyValue("line-height")?"font-size":"line-height");var s;e.forEach((t=>{const e=document.createElement("li");e.textContent=t.display,Object.assign(e.style,{padding:"3px 6px",cursor:"pointer"}),e.addEventListener("mousedown",(t=>t.preventDefault())),e.addEventListener("click",(()=>{try{this.insertTag(t.display)}catch(t){this.error("Error inserting tag:",t)}this.hideDropdown()})),this.dropdown.appendChild(e)})),Object.assign(this.dropdown.style,{top:`${t.top+o}px`,left:`${t.left+5}px`,display:"block"})}hideDropdown(){this.dropdown.style.display="none"}insertTag(t){try{this.isInputTarget()?this.insertTagForTextarea(t):this.insertTagForContentEditable(t)}catch(t){this.error("Error in insertTag:",t)}}insertTagForTextarea(t){const e=this.target,n=e.selectionStart,i=e.selectionEnd,r=e.value,o=r.lastIndexOf(this.triggerChar,n);if(-1===o)return void this.log("Trigger character not found when inserting tag in textarea");const s=r.substring(0,o),a=r.substring(i),g=this.keepTrigger?this.triggerChar:"",d=`${s}${g}${t} ${a}`;e.value=d;const l=s.length+g.length+t.length+1;e.setSelectionRange(l,l)}insertTagForContentEditable(t){const e=window.getSelection();if(this.savedRange&&e&&(e.removeAllRanges(),e.addRange(this.savedRange)),e&&e.rangeCount>0){const n=e.getRangeAt(0),i=n.startContainer;if(i.nodeType!==Node.TEXT_NODE)return void this.log("Current node is not a text node; cannot insert tag");const r=i.textContent||"",o=r.lastIndexOf(this.triggerChar,n.startOffset);if(-1===o)return void this.log("Trigger character not found in contentEditable text");const s=r.substring(0,o),a=r.substring(n.startOffset),g=(this.keepTrigger?this.triggerChar:"")+t+" ",d=document.createTextNode(s),l=document.createTextNode(g),c=document.createTextNode(a),h=i.parentNode;if(!h)return void this.error("Parent node not found; cannot insert tag");h.insertBefore(d,i),h.insertBefore(l,i),h.insertBefore(c,i),h.removeChild(i);const u=document.createRange();u.setStartAfter(l),u.collapse(!0),e.removeAllRanges(),e.addRange(u)}}destroy(){this.target.removeEventListener("keyup",this.onKeyUp.bind(this)),document.removeEventListener("click",this.onOutsideClick.bind(this)),document.body.removeChild(this.dropdown)}}})(),TagIt=e.default})();